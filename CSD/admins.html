<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admins List — Sensor Data Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { accent: '#7c3aed', soft: '#f8fafc' },
          fontFamily: { sans: ['Inter','sans-serif'] }
        }
      }
    };
  </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-soft to-white font-sans text-gray-800">
  <div class="max-w-4xl mx-auto py-10 px-6 bg-white rounded-2xl shadow-lg">
    <h1 class="text-3xl font-extrabold text-accent text-center mb-6">Admin Accounts</h1>

    <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">
      <thead class="bg-accent text-white">
        <tr>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Username</th>
          <th class="px-4 py-2 text-left">Password</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="adminsTable" class="divide-y divide-gray-100 bg-white"></tbody>
    </table>

    <div class="mt-6 text-center">
      <a href="admin-options.html" class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg text-center hover:bg-gray-300">
        ← Back
      </a>
    </div>

    <div id="msg" class="mt-4 text-center text-sm font-semibold"></div>
  </div>

  <script>
    const table = document.getElementById('adminsTable');
    const msg = document.getElementById('msg');

    async function loadAdmins() {
      table.innerHTML = `<tr><td colspan="4" class="px-4 py-3 text-center text-gray-500">Loading...</td></tr>`;
      msg.textContent = "";

      try {
        const res = await fetch('http://127.0.0.1:5000/users');
        const data = await res.json();

        if (res.ok && Array.isArray(data)) {
          table.innerHTML = "";
          const admins = data.filter(u => u.role === "admin");

          if (admins.length === 0) {
            table.innerHTML = `<tr><td colspan="4" class="px-4 py-3 text-center text-gray-500">No admins found</td></tr>`;
            return;
          }

          admins.forEach(u => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="px-4 py-2">${u.name}</td>
              <td class="px-4 py-2">${u.username}</td>
              <td class="px-4 py-2"><input type="password" value="${u.password}" class="bg-transparent" readonly></td>
              <td class="px-4 py-2">
                <button onclick="deleteAdmin(${u.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Delete</button>
              </td>
            `;
            table.appendChild(row);
          });
        } else {
          msg.textContent = "❌ Failed to load admins.";
          msg.className = "mt-4 text-center text-red-600 font-semibold";
        }
      } catch (err) {
        msg.textContent = `❌ Network error: ${err.message}`;
        msg.className = "mt-4 text-center text-red-600 font-semibold";
      }
    }

    async function deleteAdmin(id) {
      if (!confirm("Are you sure you want to delete this admin?")) return;

      try {
        const res = await fetch(`http://127.0.0.1:5000/users/${id}`, { method: 'DELETE' });
        const data = await res.json();

        if (res.ok) {
          msg.textContent = "✅ Admin deleted successfully.";
          msg.className = "mt-4 text-center text-green-600 font-semibold";
          loadAdmins();
        } else {
          msg.textContent = `❌ ${data.message || 'Failed to delete admin'}`;
          msg.className = "mt-4 text-center text-red-600 font-semibold";
        }
      } catch (err) {
        msg.textContent = `❌ Network error: ${err.message}`;
        msg.className = "mt-4 text-center text-red-600 font-semibold";
      }
    }

    loadAdmins();
  </script>
</body>
</html>